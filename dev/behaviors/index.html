<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Behaviors · Actors.jl</title><link href="https://fonts.googleapis.com/css?family=Lato|Roboto+Mono" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.11.1/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../"><img src="../assets/logo.svg" alt="Actors.jl logo"/></a><div class="docs-package-name"><span class="docs-autofit">Actors.jl</span></div><form class="docs-search" action="../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../">Actors Documentation</a></li><li><input class="collapse-toggle" id="menuitem-2" type="checkbox" checked/><label class="tocitem" for="menuitem-2"><span class="docs-label">Manual</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../intro/">Getting Started with Actors</a></li><li><a class="tocitem" href="../basics/">Actor Model</a></li><li class="is-active"><a class="tocitem" href>Behaviors</a><ul class="internal"><li><a class="tocitem" href="#Functional-Style"><span>Functional Style</span></a></li><li><a class="tocitem" href="#Object-oriented-Style"><span>Object-oriented Style</span></a></li><li><a class="tocitem" href="#Freestyle"><span>Freestyle</span></a></li><li><a class="tocitem" href="#stack"><span>Agha&#39;s Stack example</span></a></li><li><a class="tocitem" href="#Setting-and-Changing-Behavior"><span>Setting and Changing Behavior</span></a></li><li><a class="tocitem" href="#Don&#39;t-Share-Mutable-Variables"><span>Don&#39;t Share Mutable Variables</span></a></li><li><a class="tocitem" href="#Instead-Share-Actors"><span>Instead Share Actors</span></a></li></ul></li><li><a class="tocitem" href="../actors/"><code>Actors</code> and Julia</a></li><li><a class="tocitem" href="../protocol/">The <code>Actors</code> Protocol</a></li><li><a class="tocitem" href="../errors/">Error Handling</a></li><li><a class="tocitem" href="../infrastructure/">Infrastructure</a></li><li><a class="tocitem" href="../glossary/">A Glossary of Actor Terms</a></li></ul></li><li><a class="tocitem" href="../api/">API</a></li><li><input class="collapse-toggle" id="menuitem-4" type="checkbox"/><label class="tocitem" for="menuitem-4"><span class="docs-label">Examples</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../examples/dining_phil/">Dining Philosophers</a></li><li><a class="tocitem" href="../examples/prod_cons/">Producer-Consumer Problem</a></li><li><a class="tocitem" href="../examples/examples/">Further Examples</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-5" type="checkbox"/><label class="tocitem" for="menuitem-5"><span class="docs-label">Internals</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../messages/">Messages</a></li><li><a class="tocitem" href="../interface/">Interface</a></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Manual</a></li><li class="is-active"><a href>Behaviors</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Behaviors</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/JuliaActors/Actors.jl/blob/master/docs/src/behaviors.md" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="Behaviors"><a class="docs-heading-anchor" href="#Behaviors">Behaviors</a><a id="Behaviors-1"></a><a class="docs-heading-anchor-permalink" href="#Behaviors" title="Permalink"></a></h1><p>A behavior is a ...</p><blockquote><p>... function to express what an actor does when it processes a message. <sup class="footnote-reference"><a id="citeref-1" href="#footnote-1">[1]</a></sup></p><p>The behavior of an actor maps the incoming communication to a three tuple of tasks created, new actors created, and the replacement behavior. <sup class="footnote-reference"><a id="citeref-2" href="#footnote-2">[2]</a></sup></p></blockquote><div>\[\begin{array}{lrl}
f_i(a_i)[c_i] &amp; \rightarrow &amp;\{\{\tau_u,\tau_v, ...\},\;\{\alpha_x,\alpha_y,...\},\;f_{i+1}(a_{i+1})\} \quad\\
\textrm{with} &amp; f: &amp; \textrm{behavior function} \\
 &amp; a: &amp; \textrm{acquaintances,} \\
 &amp; c: &amp; \textrm{communication,} \\
 &amp; \tau: &amp; \textrm{tasks created,} \\
 &amp; \alpha: &amp; \textrm{actors created.} \\
\end{array}\]</div><p>The behavior thus can be seen as a <a href="https://en.wikipedia.org/wiki/Partial_application">partial application</a> of a function <span>$f$</span> to acquaintances <span>$a$</span> (variables or values the actor knows of). If a communication <span>$c$</span> arrives, the behavior executes <span>$f(a,c)$</span>:</p><pre><code class="language-julia-repl">julia&gt; f(a, c) = a + c         # define a function
f (generic function with 1 method)

julia&gt; partial(f, a...; kw...) = (c...) -&gt; f(a..., c...; kw...)
partial (generic function with 1 method)

julia&gt; bhv = partial(f, 1)     # partially apply f to 1
#2 (generic function with 1 method)

julia&gt; bhv(2)                  # execute f(1,2)
3</code></pre><p>Actor behavior can be represented in a functional or in an object-oriented style. Both are interchangeable.</p><h2 id="Functional-Style"><a class="docs-heading-anchor" href="#Functional-Style">Functional Style</a><a id="Functional-Style-1"></a><a class="docs-heading-anchor-permalink" href="#Functional-Style" title="Permalink"></a></h2><p>We represent a behavior as a function <code>f</code> together with acquaintance arguments <code>a...</code> and <code>kw...</code> (keyword arguments) to it. As above <a href="../api/#Actors.Bhv"><code>Bhv</code></a> creates a partial application (a closure) <code>ϕ(a...; kw...)</code> which  can be executed with communication arguments <code>c...</code>:</p><pre><code class="language-julia-repl">julia&gt; using Actors

julia&gt; f(s, t, u, v; w=1, x=1) = s + t + u + v + w + x   # a function
f (generic function with 1 method)

julia&gt; bhv = Bhv(f, 1, 1, w=2, x=2);  # create a Bhv with f and acquaintances

julia&gt; bhv(1, 1)                      # execute it with communication parameters
8</code></pre><h2 id="Object-oriented-Style"><a class="docs-heading-anchor" href="#Object-oriented-Style">Object-oriented Style</a><a id="Object-oriented-Style-1"></a><a class="docs-heading-anchor-permalink" href="#Object-oriented-Style" title="Permalink"></a></h2><p>Alternatively we put the acquaintance parameters in an object which we make executable (e.g. a <a href="https://en.wikipedia.org/wiki/Function_object">functor</a>) with communication parameters:</p><pre><code class="language-julia-repl">julia&gt; struct Acqu                    # define an object with acquaintances
           s; t; w; x
       end

julia&gt; (a::Acqu)(u, v) = a.s + a.t + u + v + a.w + a.x  # make it executable with communication parameters

julia&gt; bhv = Acqu(1,1,2,2)            # create an instance
Main.##ex-#256.Acqu(1, 1, 2, 2)

julia&gt; bhv(1,1)                       # execute it with communication parameters
8</code></pre><h2 id="Freestyle"><a class="docs-heading-anchor" href="#Freestyle">Freestyle</a><a id="Freestyle-1"></a><a class="docs-heading-anchor-permalink" href="#Freestyle" title="Permalink"></a></h2><p>With being callable the only hard requirement for a behavior, you can pass anything callable as behavior to an actor regardless whether it contains acquaintances or not:</p><pre><code class="language-julia-repl">julia&gt; using Actors, .Threads

julia&gt; import Actors: spawn, newLink

julia&gt; myactor = spawn(threadid)                     # a parameterless function
Link{Channel{Any}}(Channel{Any}(sz_max:32,sz_curr:0), 1, :default)

julia&gt; call(myactor)
2

julia&gt; become!(myactor, (lk, x, y) -&gt; send(lk, x^y)) # an anonymous function with communication arguments
Actors.Become(Main.##ex-#257.var&quot;#1#2&quot;())

julia&gt; me = newLink()
Link{Channel{Any}}(Channel{Any}(sz_max:32,sz_curr:0), 1, :local)

julia&gt; send(myactor, me, 123, 456)
(Link{Channel{Any}}(Channel{Any}(sz_max:32,sz_curr:1), 1, :local), 123, 456)

julia&gt; receive(me)
2409344748064316129</code></pre><p>You can give functors further acquaintance parameters (as for the players in the <a href="../basics/#table-tennis">table-tennis example</a>). Of course you can give objects containing acquaintances as parameters to a function and create a partial application with <code>Bhv</code> on them and much more. Be my guest!</p><h2 id="stack"><a class="docs-heading-anchor" href="#stack">Agha&#39;s Stack example</a><a id="stack-1"></a><a class="docs-heading-anchor-permalink" href="#stack" title="Permalink"></a></h2><p>Now more realistically for actor behavior we reproduce Agha&#39;s example 3.2.1 <sup class="footnote-reference"><a id="citeref-3" href="#footnote-3">[3]</a></sup>:</p><pre><code class="language-julia">using Actors
import Actors: spawn, newLink

mutable struct StackNode{T,L}  # a stack node object
    content::T
    link::L
end

struct Pop{L}                  # a pop message
    customer::L
end

struct Push{T}                 # a push message
    content::T
end

# now three behavior methods
forwarder = send
function (sn::StackNode)(msg::Pop)
    isnothing(sn.content) || become(forwarder, sn.link)
    send(msg.customer, Response(sn.content))
end
(sn::StackNode)(msg::Push) = become(StackNode(msg.content, spawn(sn)))</code></pre><p>Here we use both the functional and the object oriented approach:</p><ul><li><code>forwarder</code> is a function which we put together with <code>sn.link</code> into a <code>Bhv</code>,</li><li><code>StackNode</code> is an object, which gets two methods.</li></ul><p>Now we can operate the stack:</p><pre><code class="language-julia">julia&gt; mystack = spawn(StackNode(nothing, newLink()))
Link{Channel{Any}}(Channel{Any}(sz_max:32,sz_curr:0), 1, :default)

julia&gt; response = newLink()
Link{Channel{Any}}(Channel{Any}(sz_max:32,sz_curr:0), 1, :local)

julia&gt; for i ∈ 1:5
           send(mystack, Push(i))
       end

julia&gt; for i ∈ 1:5
           send(mystack, Pop(response))
           println(receive(response).y)
       end
5
4
3
2
1</code></pre><h2 id="Setting-and-Changing-Behavior"><a class="docs-heading-anchor" href="#Setting-and-Changing-Behavior">Setting and Changing Behavior</a><a id="Setting-and-Changing-Behavior-1"></a><a class="docs-heading-anchor-permalink" href="#Setting-and-Changing-Behavior" title="Permalink"></a></h2><p>An actor&#39;s behavior is set with <a href="../api/#ActorInterfaces.Classic.spawn"><code>spawn</code></a> and gets changed with <a href="../api/#Actors.become!"><code>become!</code></a>. Inside a behavior function an actor can change its own behavior with <a href="../api/#ActorInterfaces.Classic.become"><code>become</code></a>. In both cases a callable object together with acquaintance arguments can be specified as new behavior. This is effective when the next message gets processed.</p><h2 id="Don&#39;t-Share-Mutable-Variables"><a class="docs-heading-anchor" href="#Don&#39;t-Share-Mutable-Variables">Don&#39;t Share Mutable Variables</a><a id="Don&#39;t-Share-Mutable-Variables-1"></a><a class="docs-heading-anchor-permalink" href="#Don&#39;t-Share-Mutable-Variables" title="Permalink"></a></h2><p>As you have seen, you are very free in how you define behaviors, but you must be very careful in passing mutable variables as acquaintances to actors as they could be accessed by other actors on other threads concurrently causing race conditions. </p><h2 id="Instead-Share-Actors"><a class="docs-heading-anchor" href="#Instead-Share-Actors">Instead Share Actors</a><a id="Instead-Share-Actors-1"></a><a class="docs-heading-anchor-permalink" href="#Instead-Share-Actors" title="Permalink"></a></h2><p>It is thread-safe to share actors between threads or other actors. Each call to the shared actor is a communication.</p><ul><li>In the <a href="../basics/#table-tennis">table-tennis</a> example we shared a print server actor between player actors working on different threads.</li><li>In the <a href="../actors/#dict-server">Dict-server</a> example a dictionary gets served by an actor to parallel threads.</li><li>You can wrap mutable variables into a <a href="https://github.com/JuliaActors/Guards.jl"><code>:guard</code></a> actor, which will manage access to them.</li><li>In more complicated cases of resource sharing you can use a <a href="https://github.com/JuliaActors/GenServers.jl"><code>:genserver</code></a> actor.</li></ul><p>As those examples show, it is surprisingly easy to avoid race conditions by using actors.</p><section class="footnotes is-size-7"><ul><li class="footnote" id="footnote-1"><a class="tag is-link" href="#citeref-1">1</a>see the <a href="https://en.wikipedia.org/wiki/Actor_model#Behaviors">Actor Model</a> on Wikipedia.</li><li class="footnote" id="footnote-2"><a class="tag is-link" href="#citeref-2">2</a>Gul Agha 1986. <em>Actors. a model of concurrent computation in distributed systems</em>, MIT.- p. 30</li><li class="footnote" id="footnote-3"><a class="tag is-link" href="#citeref-3">3</a>ibid. p. 34</li></ul></section></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../basics/">« Actor Model</a><a class="docs-footer-nextpage" href="../actors/"><code>Actors</code> and Julia »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> on <span class="colophon-date" title="Sunday 20 December 2020 16:39">Sunday 20 December 2020</span>. Using Julia version 1.5.3.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
