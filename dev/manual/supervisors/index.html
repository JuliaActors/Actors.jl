<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Supervisors · Actors.jl</title><link href="https://fonts.googleapis.com/css?family=Lato|Roboto+Mono" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.0/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.0/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.0/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.11.1/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../../"><img src="../../assets/logo.svg" alt="Actors.jl logo"/></a><div class="docs-package-name"><span class="docs-autofit">Actors.jl</span></div><form class="docs-search" action="../../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../../">Introduction</a></li><li><input class="collapse-toggle" id="menuitem-2" type="checkbox"/><label class="tocitem" for="menuitem-2"><span class="docs-label">Tutorials</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../tutorial/install/">Install and Use <code>Actors</code></a></li><li><a class="tocitem" href="../../tutorial/intro/">Getting Started with Actors</a></li><li><a class="tocitem" href="../../tutorial/tabletennis/">Simulate a Game</a></li><li><a class="tocitem" href="../../tutorial/stack/">Implement a Stack</a></li><li><a class="tocitem" href="../../tutorial/dictsrv/">Implement a thread-safe <code>Dict</code></a></li><li><a class="tocitem" href="../../tutorial/supervise/">Supervise Actors</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-3" type="checkbox"/><label class="tocitem" for="menuitem-3"><span class="docs-label">How to</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../howto/spawn/"><code>spawn</code> actors</a></li><li><a class="tocitem" href="../../howto/communicate/">communicate with actors</a></li><li><a class="tocitem" href="../../howto/information/">get information from actors</a></li><li><a class="tocitem" href="../../howto/share/">(not) share variables</a></li><li><a class="tocitem" href="../../howto/failure/">deal with failures</a></li><li><a class="tocitem" href="../../howto/register/"><code>register</code> actors</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-4" type="checkbox" checked/><label class="tocitem" for="menuitem-4"><span class="docs-label">On Actors</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../basics/">Actor Model</a></li><li><a class="tocitem" href="../actors/">Actors and Julia</a></li><li><a class="tocitem" href="../behaviors/">Actor Behavior</a></li><li><a class="tocitem" href="../protocol/">Messaging Protocol</a></li><li><input class="collapse-toggle" id="menuitem-4-5" type="checkbox" checked/><label class="tocitem" for="menuitem-4-5"><span class="docs-label">Error Handling</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../errors/">Error Handling Overview</a></li><li><a class="tocitem" href="../connections/">Connections</a></li><li><a class="tocitem" href="../monitors/">Monitors</a></li><li class="is-active"><a class="tocitem" href>Supervisors</a><ul class="internal"><li><a class="tocitem" href="#Supervision-strategy"><span>Supervision strategy</span></a></li><li><a class="tocitem" href="#Actor-State-Across-Restarts"><span>Actor State Across Restarts</span></a></li><li><a class="tocitem" href="#Termination-and-Restart-Callbacks"><span>Termination and Restart Callbacks</span></a></li><li><a class="tocitem" href="#Preserving-Actor-Links"><span>Preserving Actor Links</span></a></li><li><a class="tocitem" href="#Limit-Restarts"><span>Limit Restarts</span></a></li><li><a class="tocitem" href="#Task-Supervision"><span>Task Supervision</span></a></li><li><a class="tocitem" href="#Supervisory-trees"><span>Supervisory trees</span></a></li></ul></li><li><a class="tocitem" href="../node_failures/">Node Failures</a></li><li><a class="tocitem" href="../checkpoints/">Checkpointing</a></li><li><a class="tocitem" href="../fault_tolerance/">Fault Tolerance</a></li></ul></li><li><a class="tocitem" href="../infrastructure/">More Useful Stuff</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-5" type="checkbox"/><label class="tocitem" for="menuitem-5"><span class="docs-label">Reference</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><input class="collapse-toggle" id="menuitem-5-1" type="checkbox"/><label class="tocitem" for="menuitem-5-1"><span class="docs-label">API</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../api/api/"><code>Actors</code> Module</a></li><li><a class="tocitem" href="../../api/types/">Basic Types</a></li><li><a class="tocitem" href="../../api/starting/">Starting Actors, creating links</a></li><li><a class="tocitem" href="../../api/primitives/">Actor Primitives</a></li><li><a class="tocitem" href="../../api/comm/">Communication primitives</a></li><li><a class="tocitem" href="../../api/user_api/">User API</a></li><li><a class="tocitem" href="../../api/registry/">Actor Registry</a></li><li><a class="tocitem" href="../../api/connect/">Connections</a></li><li><a class="tocitem" href="../../api/monitor/">Monitors</a></li><li><a class="tocitem" href="../../api/supervision/">Supervisors</a></li><li><a class="tocitem" href="../../api/checkpointing/">Checkpointing</a></li><li><a class="tocitem" href="../../api/utils/">Utilities</a></li><li><a class="tocitem" href="../../api/diagnosis/">Diagnosis</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-5-2" type="checkbox"/><label class="tocitem" for="menuitem-5-2"><span class="docs-label">Examples</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../examples/dining_phil/">Dining Philosophers</a></li><li><a class="tocitem" href="../../examples/prod_cons/">Producer-Consumer Problem</a></li><li><a class="tocitem" href="../../examples/examples/">Further Examples</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-5-3" type="checkbox"/><label class="tocitem" for="menuitem-5-3"><span class="docs-label">Internals</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../reference/diag/">Diagnostics</a></li><li><a class="tocitem" href="../../reference/internals/">Internals</a></li><li><a class="tocitem" href="../../reference/messages/">Messages</a></li><li><a class="tocitem" href="../../reference/interface/">Interface</a></li></ul></li><li><a class="tocitem" href="../../reference/glossary/">A Glossary of Actor Terms</a></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">On Actors</a></li><li><a class="is-disabled">Error Handling</a></li><li class="is-active"><a href>Supervisors</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Supervisors</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/JuliaActors/Actors.jl/blob/master/docs/src/manual/supervisors.md" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="Supervisors"><a class="docs-heading-anchor" href="#Supervisors">Supervisors</a><a id="Supervisors-1"></a><a class="docs-heading-anchor-permalink" href="#Supervisors" title="Permalink"></a></h1><p>If we want actors to be restarted automatically if they fail, we can use <a href="../../api/supervision/#Actors.supervise"><code>supervise</code></a> to put them under the supervision of a <a href="../../api/supervision/#Actors.supervisor"><code>supervisor</code></a> actor. Lets consider a system of six actors <code>A1</code> - <code>A6</code> under supervision of the supervisor <code>A10</code>. Such a system may look as follows:</p><p><img src="../../assets/supervisor.svg" alt="supervisor"/></p><p>The six actors <code>A1</code> - <code>A6</code> are connected to their supervisor A10 and will send it an <a href="../../reference/messages/#Actors.Exit"><code>Exit</code></a> message before they exit. They will not notify each other. It is the duty of the supervisor to decide, what to do.</p><p>What the supervisor does, should one of its child actors – say <code>A4</code> - fail, depends on three parameters:</p><ol><li>the <a href="../../api/supervision/#strategies">supervision strategy</a> (<code>:one_for_one</code>, <code>:one_for_all</code> and <code>:rest_for_one</code>) of the <code>supervisor</code>,</li><li>the <a href="../../api/supervision/#restart">restart option</a> (<code>:transient</code>, <code>:permanent</code>, <code>:temporary</code>) of the <code>supervise</code>d child and</li><li>the <code>Exit</code> reason.</li></ol><h2 id="Supervision-strategy"><a class="docs-heading-anchor" href="#Supervision-strategy">Supervision strategy</a><a id="Supervision-strategy-1"></a><a class="docs-heading-anchor-permalink" href="#Supervision-strategy" title="Permalink"></a></h2><p>Let&#39;s discuss the depicted case of actor <code>A4</code> failing: We assume <code>:transient</code> child actors, meaning they are restarted if they terminate abnormally, that is, if they fail. Now what happens depends solely on the supervisor&#39;s strategy.</p><table><tr><th style="text-align: left">strategy</th><th style="text-align: left">the supervisor will restart ...</th></tr><tr><td style="text-align: left"><code>:one_for_one</code></td><td style="text-align: left">the failed actor <code>A4</code>,</td></tr><tr><td style="text-align: left"><code>:one_for_all</code></td><td style="text-align: left">all child actors <code>A1</code> - <code>A6</code>,</td></tr><tr><td style="text-align: left"><code>:rest_for_one</code></td><td style="text-align: left">the failed actor <code>A4</code> and the actors <code>A5</code> and <code>A6</code> registered to the supervisor after it.</td></tr></table><p>In the second and third case the other actors are shutdown by the supervisor before being restarted.</p><p>You can see this in action in the <a href="../../tutorial/supervise/">Supervise Actors tutorial</a>.</p><h2 id="Actor-State-Across-Restarts"><a class="docs-heading-anchor" href="#Actor-State-Across-Restarts">Actor State Across Restarts</a><a id="Actor-State-Across-Restarts-1"></a><a class="docs-heading-anchor-permalink" href="#Actor-State-Across-Restarts" title="Permalink"></a></h2><p>A failing actor transfers its behavior (behavior function and acquaintance variables) to the supervisor before it exits. Thus the supervisor can restart that actor with its state, that it had before processing the last message. That is also demonstrated in the <a href="../../tutorial/supervise/">Supervise Actors tutorial</a>.</p><p>That strategy maybe sufficient for many cases, but you can change it by setting termination and restart callbacks.</p><h2 id="Termination-and-Restart-Callbacks"><a class="docs-heading-anchor" href="#Termination-and-Restart-Callbacks">Termination and Restart Callbacks</a><a id="Termination-and-Restart-Callbacks-1"></a><a class="docs-heading-anchor-permalink" href="#Termination-and-Restart-Callbacks" title="Permalink"></a></h2><p>There are cases where you want a different user-defined fallback strategy for actor restart, for example to</p><ul><li>restart it with a different algorithm/behavior or data set or</li><li>do some cleanup before restarting it,</li><li>restart after a node failure,</li><li>save and restore a checkpoint.</li></ul><p>For that you can define callback functions invoked at actor termination, restart or initialization:</p><table><tr><th style="text-align: left">callback</th><th style="text-align: left">short description</th></tr><tr><td style="text-align: left"><a href="../../api/user_api/#Actors.term!"><code>term!</code></a></td><td style="text-align: left"><code>term</code> callback; if defined, it is called at actor exit with argument <code>reason</code> (exit reason),</td></tr><tr><td style="text-align: left"><code>restart</code></td><td style="text-align: left">a given <code>cb</code> argument to <a href="../../api/supervision/#Actors.supervise"><code>supervise</code></a>, <a href="../../api/supervision/#Actors.start_actor"><code>start_actor</code></a> or <a href="../../api/supervision/#Actors.start_task"><code>start_task</code></a> is executed by a supervisor to restart an actor/task;</td></tr><tr><td style="text-align: left"><a href="../../api/user_api/#Actors.init!"><code>init!</code></a></td><td style="text-align: left">if defined (and no <code>restart</code> callback is given), the supervisor restarts an actor with the given <code>init</code> behavior.</td></tr></table><p>User defined callbacks must follow some conventions:</p><ol><li>A <code>restart</code> callback does some initialization and spawns an actor or a task and returns a <a href="../../api/types/#Actors.Link"><code>Link</code></a> or a <code>Task</code> which  again will be supervised.</li><li>An <code>init</code> callback is a startup <em>behavior</em> of an actor. It does some initialization or recovery and then switches (with <a href="../../api/primitives/#ActorInterfaces.Classic.become"><code>become</code></a>) to the target behavior. A supervisor spawns a new supervised actor with the given <code>init</code> behavior and triggers it with <code>init()</code>.</li><li>A supervisor wants an actor running on a worker process (over a <code>RemoteChannel</code>) to restart on the same or on a spare <code>pid</code> (process id). In that case it calls the <code>restart</code> callback with a <code>pid</code> keyword argument (and the callback must take it).</li></ol><h2 id="Preserving-Actor-Links"><a class="docs-heading-anchor" href="#Preserving-Actor-Links">Preserving Actor Links</a><a id="Preserving-Actor-Links-1"></a><a class="docs-heading-anchor-permalink" href="#Preserving-Actor-Links" title="Permalink"></a></h2><p>After restarting an actor, a supervisor updates its link to point to the newly created actor. But copies of a link won&#39;t get updated and may then be out of sync.</p><p>If remote actors on other workers communicate with an actor over <code>RemoteChannel</code>s, they have copies of its link on their workers. After actor restart those are out of sync, and a remote actor may then try to communicate with an old failed actor. To avoid this situation, you should <a href="../../howto/register/">register</a> supervised remote actors and use their registered names to supervise them and communicate with them. The supervisor then will update the registered link.</p><h2 id="Limit-Restarts"><a class="docs-heading-anchor" href="#Limit-Restarts">Limit Restarts</a><a id="Limit-Restarts-1"></a><a class="docs-heading-anchor-permalink" href="#Limit-Restarts" title="Permalink"></a></h2><p>A supervisor takes two additional arguments: <code>max_restarts</code> and <code>max_seconds</code> where you can limit the number of restarts it does in the <code>max_seconds</code> time frame. If failures exceed that limit, a supervisor will shutdown its child actors and itself with an error message.</p><h2 id="Task-Supervision"><a class="docs-heading-anchor" href="#Task-Supervision">Task Supervision</a><a id="Task-Supervision-1"></a><a class="docs-heading-anchor-permalink" href="#Task-Supervision" title="Permalink"></a></h2><h2 id="Supervisory-trees"><a class="docs-heading-anchor" href="#Supervisory-trees">Supervisory trees</a><a id="Supervisory-trees-1"></a><a class="docs-heading-anchor-permalink" href="#Supervisory-trees" title="Permalink"></a></h2><p>For larger applications you may be interested in building a hierarchical structure containing all actors and tasks. This is called a supervisory tree, and there is the <a href="https://github.com/JuliaActors/Supervisors.jl"><code>Supervisors</code></a> package facilitating to build that.</p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../monitors/">« Monitors</a><a class="docs-footer-nextpage" href="../node_failures/">Node Failures »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> on <span class="colophon-date" title="Thursday 22 April 2021 06:19">Thursday 22 April 2021</span>. Using Julia version 1.6.0.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
