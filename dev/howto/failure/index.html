<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>deal with failures · Actors.jl</title><link href="https://fonts.googleapis.com/css?family=Lato|Roboto+Mono" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.0/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.0/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.0/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.11.1/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../../"><img src="../../assets/logo.svg" alt="Actors.jl logo"/></a><div class="docs-package-name"><span class="docs-autofit">Actors.jl</span></div><form class="docs-search" action="../../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../../">Introduction</a></li><li><input class="collapse-toggle" id="menuitem-2" type="checkbox"/><label class="tocitem" for="menuitem-2"><span class="docs-label">Tutorials</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../tutorial/install/">Install and Use <code>Actors</code></a></li><li><a class="tocitem" href="../../tutorial/intro/">Getting Started with Actors</a></li><li><a class="tocitem" href="../../tutorial/tabletennis/">Simulate a Game</a></li><li><a class="tocitem" href="../../tutorial/stack/">Implement a Stack</a></li><li><a class="tocitem" href="../../tutorial/dictsrv/">Implement a thread-safe <code>Dict</code></a></li><li><a class="tocitem" href="../../tutorial/supervise/">Supervise Actors</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-3" type="checkbox" checked/><label class="tocitem" for="menuitem-3"><span class="docs-label">How to</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../spawn/"><code>spawn</code> actors</a></li><li><a class="tocitem" href="../communicate/">communicate with actors</a></li><li><a class="tocitem" href="../information/">get information from actors</a></li><li><a class="tocitem" href="../share/">(not) share variables</a></li><li class="is-active"><a class="tocitem" href>deal with failures</a><ul class="internal"><li><a class="tocitem" href="#Let-it-crash"><span>Let it crash</span></a></li><li><a class="tocitem" href="#connect"><span><code>connect</code> actors</span></a></li><li><a class="tocitem" href="#monitor"><span><code>monitor</code> actors and tasks</span></a></li><li><a class="tocitem" href="#supervise-actors"><span><code>supervise</code> actors</span></a></li><li><a class="tocitem" href="#take-checkpoints"><span>take checkpoints</span></a></li><li><a class="tocitem" href="#define-exit-and-init-behaviors"><span>define exit and init behaviors</span></a></li></ul></li><li><a class="tocitem" href="../register/"><code>register</code> actors</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-4" type="checkbox"/><label class="tocitem" for="menuitem-4"><span class="docs-label">On Actors</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../manual/basics/">Actor Model</a></li><li><a class="tocitem" href="../../manual/actors/">Actors and Julia</a></li><li><a class="tocitem" href="../../manual/behaviors/">Actor Behavior</a></li><li><a class="tocitem" href="../../manual/protocol/">Messaging Protocol</a></li><li><input class="collapse-toggle" id="menuitem-4-5" type="checkbox"/><label class="tocitem" for="menuitem-4-5"><span class="docs-label">Error Handling</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../manual/errors/">Error Handling Overview</a></li><li><a class="tocitem" href="../../manual/connections/">Connections</a></li><li><a class="tocitem" href="../../manual/monitors/">Monitors</a></li><li><a class="tocitem" href="../../manual/supervisors/">Supervisors</a></li><li><a class="tocitem" href="../../manual/node_failures/">Node Failures</a></li><li><a class="tocitem" href="../../manual/checkpoints/">Checkpointing</a></li><li><a class="tocitem" href="../../manual/fault_tolerance/">Fault Tolerance</a></li></ul></li><li><a class="tocitem" href="../../manual/infrastructure/">More Useful Stuff</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-5" type="checkbox"/><label class="tocitem" for="menuitem-5"><span class="docs-label">Reference</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><input class="collapse-toggle" id="menuitem-5-1" type="checkbox"/><label class="tocitem" for="menuitem-5-1"><span class="docs-label">API</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../api/api/"><code>Actors</code> Module</a></li><li><a class="tocitem" href="../../api/types/">Basic Types</a></li><li><a class="tocitem" href="../../api/starting/">Starting Actors, creating links</a></li><li><a class="tocitem" href="../../api/primitives/">Actor Primitives</a></li><li><a class="tocitem" href="../../api/comm/">Communication primitives</a></li><li><a class="tocitem" href="../../api/user_api/">User API</a></li><li><a class="tocitem" href="../../api/registry/">Actor Registry</a></li><li><a class="tocitem" href="../../api/connect/">Connections</a></li><li><a class="tocitem" href="../../api/monitor/">Monitors</a></li><li><a class="tocitem" href="../../api/supervision/">Supervisors</a></li><li><a class="tocitem" href="../../api/checkpointing/">Checkpointing</a></li><li><a class="tocitem" href="../../api/utils/">Utilities</a></li><li><a class="tocitem" href="../../api/diagnosis/">Diagnosis</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-5-2" type="checkbox"/><label class="tocitem" for="menuitem-5-2"><span class="docs-label">Examples</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../examples/dining_phil/">Dining Philosophers</a></li><li><a class="tocitem" href="../../examples/prod_cons/">Producer-Consumer Problem</a></li><li><a class="tocitem" href="../../examples/examples/">Further Examples</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-5-3" type="checkbox"/><label class="tocitem" for="menuitem-5-3"><span class="docs-label">Internals</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../reference/diag/">Diagnostics</a></li><li><a class="tocitem" href="../../reference/internals/">Internals</a></li><li><a class="tocitem" href="../../reference/messages/">Messages</a></li><li><a class="tocitem" href="../../reference/interface/">Interface</a></li></ul></li><li><a class="tocitem" href="../../reference/glossary/">A Glossary of Actor Terms</a></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">How to</a></li><li class="is-active"><a href>deal with failures</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>deal with failures</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/JuliaActors/Actors.jl/blob/master/docs/src/howto/failure.md" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="How-to-deal-with-failures"><a class="docs-heading-anchor" href="#How-to-deal-with-failures">How to deal with failures</a><a id="How-to-deal-with-failures-1"></a><a class="docs-heading-anchor-permalink" href="#How-to-deal-with-failures" title="Permalink"></a></h1><p><code>Actors</code> adopts Erlang&#39;s error handling philosophy <sup class="footnote-reference"><a id="citeref-1" href="#footnote-1">[1]</a></sup> and gives you a lot of options to deal with failures and to write fault-tolerant applications.</p><h2 id="Let-it-crash"><a class="docs-heading-anchor" href="#Let-it-crash">Let it crash</a><a id="Let-it-crash-1"></a><a class="docs-heading-anchor-permalink" href="#Let-it-crash" title="Permalink"></a></h2><p>In short if an actor fails, don&#39;t try to avoid it but</p><ul><li>let it crash and</li><li>let some other actor do the error recovery.</li></ul><p>Therefore as a basic mechanism you want actors to connect with peer, monitor or supervisor actors to signal failures in an actor system and to do something about it.</p><h2 id="connect"><a class="docs-heading-anchor" href="#connect"><code>connect</code> actors</a><a id="connect-1"></a><a class="docs-heading-anchor-permalink" href="#connect" title="Permalink"></a></h2><p>If an actor fails, we want other actors that depend on it also actively fail before they get into some undefined state. To achieve that, we can connect dependent actors. Connected actors will propagate a failure to each other until they encounter a <code>:sticky</code> actor. To connect actors, you</p><ol><li>have arbitrary actors (e.g. <code>A[1]</code> - <code>A[10]</code>),</li><li>tell some of them to <a href="../../api/connect/#Actors.connect"><code>connect</code></a> with each other,</li><li>if needed, make some of them <code>:sticky</code> with <a href="../../api/connect/#Actors.trapExit"><code>trapExit</code></a> in order to block the failure propagation.</li></ol><pre><code class="language-julia">julia&gt; using Actors, .Threads

julia&gt; import Actors: spawn

julia&gt; A = map((_)-&gt;spawn(threadid), 1:10); # create 10 actors

julia&gt; exec(A[3], connect, A[1]);           # connect A3 - A1

julia&gt; exec(A[3], connect, A[7]);           # connect A3 - A7

julia&gt; exec(A[9], connect, A[7]);           # connect A9 - A7

julia&gt; exec(A[9], connect, A[4]);           # connect A9 - A4

julia&gt; t = map(a-&gt;Actors.diag(a, :task), A) # create a task list
10-element Vector{Task}:
 Task (runnable) @0x000000016e949220
 Task (runnable) @0x000000016e94a100
 Task (runnable) @0x000000016e94a320
 Task (runnable) @0x000000016e94a540
 Task (runnable) @0x000000016e94a760
 Task (runnable) @0x000000016e94a980
 Task (runnable) @0x000000016e94aba0
 Task (runnable) @0x000000016e94adc0
 Task (runnable) @0x000000016e94b0f0
 Task (runnable) @0x000000016e94b310

julia&gt; trapExit(A[3])                       # make A3 a sticky actor
Actors.Update(:mode, :sticky)</code></pre><p>If one of the connected actors fails, it will send an <a href="../../reference/messages/#Actors.Exit"><code>Exit</code></a> message to its connected actors. Those will propagate the <code>Exit</code> further to their connected actors and terminate. If you made one <code>:sticky</code>, that will give a warning (and not exit).</p><pre><code class="language-julia">julia&gt; send(A[9], :boom);                   # cause A9 to fail
┌ Warning: 2021-02-13 12:08:11 x-d-kupih-pasob: Exit: connected Task (failed) @0x000000016e94b0f0, MethodError(Base.Threads.threadid, (:boom,), 0x0000000000007447)
└ @ Actors ~/.julia/dev/Actors/src/logging.jl:31

julia&gt; t                                    # display the task list again
10-element Vector{Task}:
 Task (runnable) @0x000000016e949220
 Task (runnable) @0x000000016e94a100
 Task (runnable) @0x000000016e94a320
 Task (done) @0x000000016e94a540
 Task (runnable) @0x000000016e94a760
 Task (runnable) @0x000000016e94a980
 Task (done) @0x000000016e94aba0
 Task (runnable) @0x000000016e94adc0
 Task (failed) @0x000000016e94b0f0
 Task (runnable) @0x000000016e94b310</code></pre><p>With <a href="../../api/diagnosis/#Actors.diag"><code>Actors.diag</code></a> you can get an error log and access to the failed task from the <code>:sticky</code> actor <code>A[3]</code>.</p><p>You can view a graphical representation and further explanation <a href="../../manual/connections/">in the manual</a>.</p><h2 id="monitor"><a class="docs-heading-anchor" href="#monitor"><code>monitor</code> actors and tasks</a><a id="monitor-1"></a><a class="docs-heading-anchor-permalink" href="#monitor" title="Permalink"></a></h2><p>We can make an arbitrary actor a <a href="../../manual/monitors/">monitor</a> that watches other actors and give warnings or execute specified options if they exit.</p><p>For example we start three actors A1-A3. We make <code>A3</code> a <a href="../../api/monitor/#Actors.monitor"><code>monitor</code></a> for <code>A1</code> and <code>A2</code>. Then it gets a <code>Down</code> signal from its monitored actors if they exit.</p><pre><code class="language-julia">julia&gt; A = map(_-&gt;spawn(threadid), 1:3);

julia&gt; exec(A[3], monitor, A[1]);

julia&gt; exec(A[3], monitor, A[2]);

julia&gt; t = map(a-&gt;Actors.diag(a, :task), A)
3-element Vector{Task}:
 Task (runnable) @0x000000010f8f5000
 Task (runnable) @0x000000010fbb8120
 Task (runnable) @0x000000010fbb8890

julia&gt; exit!(A[1]);
┌ Warning: 2021-02-13 12:36:32 x-d-uvur-mofib: Down:  normal
└ @ Actors ~/.julia/dev/Actors/src/logging.jl:31

julia&gt; send(A[2], :boom);
┌ Warning: 2021-02-13 12:36:58 x-d-uvur-mofib: Down:  Task (failed) @0x000000010fbb8120, MethodError(Base.Threads.threadid, (:boom,), 0x000000000000744f)
└ @ Actors ~/.julia/dev/Actors/src/logging.jl:31

julia&gt; t
3-element Vector{Task}:
 Task (done) @0x000000010f8f5000
 Task (failed) @0x000000010fbb8120
 Task (runnable) @0x000000010fbb8890</code></pre><h2 id="supervise-actors"><a class="docs-heading-anchor" href="#supervise-actors"><code>supervise</code> actors</a><a id="supervise-actors-1"></a><a class="docs-heading-anchor-permalink" href="#supervise-actors" title="Permalink"></a></h2><p>By supervision you can restart actors automatically if they fail or if the remote node fails, on which they reside.</p><p>Please see the</p><ul><li><a href="../../tutorial/supervise/">Supervise Actors tutorial</a> for an introduction,</li><li><a href="../../manual/supervisors/">Supervisors manual</a> for illustration and explanations,</li><li><a href="../../manual/node_failures/">Node Failures manual</a> for explanation of supervision of node failures,</li><li><a href="../../api/supervision/">Supervisors API reference</a> for more informations.</li></ul><h2 id="take-checkpoints"><a class="docs-heading-anchor" href="#take-checkpoints">take checkpoints</a><a id="take-checkpoints-1"></a><a class="docs-heading-anchor-permalink" href="#take-checkpoints" title="Permalink"></a></h2><h2 id="define-exit-and-init-behaviors"><a class="docs-heading-anchor" href="#define-exit-and-init-behaviors">define exit and init behaviors</a><a id="define-exit-and-init-behaviors-1"></a><a class="docs-heading-anchor-permalink" href="#define-exit-and-init-behaviors" title="Permalink"></a></h2><section class="footnotes is-size-7"><ul><li class="footnote" id="footnote-1"><a class="tag is-link" href="#citeref-1">1</a>See Joe Armstrong&#39;s dissertation: <a href="https://erlang.org/download/armstrong_thesis_2003.pdf">Making reliable distributed systems in the presence of software errors</a>, ch. 4.3, pp. 104 ...</li></ul></section></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../share/">« (not) share variables</a><a class="docs-footer-nextpage" href="../register/"><code>register</code> actors »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> on <span class="colophon-date" title="Wednesday 21 April 2021 19:32">Wednesday 21 April 2021</span>. Using Julia version 1.6.0.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
