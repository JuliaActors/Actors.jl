<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Actors and Julia · Actors.jl</title><link href="https://fonts.googleapis.com/css?family=Lato|Roboto+Mono" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.11.1/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../"><img src="../assets/logo.svg" alt="Actors.jl logo"/></a><div class="docs-package-name"><span class="docs-autofit">Actors.jl</span></div><form class="docs-search" action="../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../">Actors Documentation</a></li><li><input class="collapse-toggle" id="menuitem-2" type="checkbox" checked/><label class="tocitem" for="menuitem-2"><span class="docs-label">Manual</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../intro/">Getting Started with Actors</a></li><li><a class="tocitem" href="../basics/">Actor Model</a></li><li class="is-active"><a class="tocitem" href><code>Actors</code> and Julia</a><ul class="internal"><li><a class="tocitem" href="#Julia-is-Well-Suited-for-Actors"><span>Julia is Well Suited for Actors</span></a></li><li><a class="tocitem" href="#Actors-Complements-Julia"><span><code>Actors</code> Complements Julia</span></a></li><li><a class="tocitem" href="#Multi-threading"><span>Multi-threading</span></a></li><li><a class="tocitem" href="#Distributed-Computing"><span>Distributed Computing</span></a></li><li><a class="tocitem" href="#dict-server"><span>A <code>Dict</code> Server</span></a></li><li><a class="tocitem" href="#Fault-Tolerance"><span>Fault Tolerance</span></a></li><li><a class="tocitem" href="#Actor-Isolation"><span>Actor Isolation</span></a></li><li><a class="tocitem" href="#Actor-Local-Dictionary"><span>Actor Local Dictionary</span></a></li></ul></li><li><a class="tocitem" href="../behaviors/">Behaviors</a></li><li><a class="tocitem" href="../protocol/">The <code>Actors</code> Protocol</a></li><li><a class="tocitem" href="../errors/">Error Handling</a></li><li><a class="tocitem" href="../infrastructure/">Infrastructure</a></li><li><a class="tocitem" href="../glossary/">A Glossary of Actor Terms</a></li></ul></li><li><a class="tocitem" href="../api/">API</a></li><li><input class="collapse-toggle" id="menuitem-4" type="checkbox"/><label class="tocitem" for="menuitem-4"><span class="docs-label">Examples</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../examples/dining_phil/">Dining Philosophers</a></li><li><a class="tocitem" href="../examples/prod_cons/">Producer-Consumer Problem</a></li><li><a class="tocitem" href="../examples/examples/">Further Examples</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-5" type="checkbox"/><label class="tocitem" for="menuitem-5"><span class="docs-label">Internals</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../messages/">Messages</a></li><li><a class="tocitem" href="../interface/">Interface</a></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Manual</a></li><li class="is-active"><a href><code>Actors</code> and Julia</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href><code>Actors</code> and Julia</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/JuliaActors/Actors.jl/blob/master/docs/src/actors.md" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="Actors-and-Julia"><a class="docs-heading-anchor" href="#Actors-and-Julia"><code>Actors</code> and Julia</a><a id="Actors-and-Julia-1"></a><a class="docs-heading-anchor-permalink" href="#Actors-and-Julia" title="Permalink"></a></h1><blockquote><p>It is important to distinguish the following:</p><ul><li>modeling arbitrary computational systems using Actors. It is difficult to find physical computational systems (regardless of how idiosyncratic) that cannot be modeled using Actors.</li><li>securely implementing practical computational applications using Actors remains an active area of research and development. <sup class="footnote-reference"><a id="citeref-1" href="#footnote-1">[1]</a></sup></li></ul></blockquote><h2 id="Julia-is-Well-Suited-for-Actors"><a class="docs-heading-anchor" href="#Julia-is-Well-Suited-for-Actors">Julia is Well Suited for Actors</a><a id="Julia-is-Well-Suited-for-Actors-1"></a><a class="docs-heading-anchor-permalink" href="#Julia-is-Well-Suited-for-Actors" title="Permalink"></a></h2><p><code>Actors</code> implements the <a href="../basics/">Actor model</a> using Julia&#39;s concurrency primitives:</p><ul><li>Actors are implemented as <code>Task</code>s.</li><li>They communicate over <code>Channel</code>s.</li></ul><p>Both tasks and channels could be modeled as actors, but they are not. Thus <code>Actors</code> is a library and not &quot;Actors all the way down&quot; <sup class="footnote-reference"><a id="citeref-2" href="#footnote-2">[2]</a></sup>.</p><p>Given its concurrency primitives, particularly Julia&#39;s expressiveness with functions allows a practical implementation of the Actor model:</p><ol><li>Actors are created with functions or functors as behaviors which</li><li>can be partially applied to acquaintance parameters.</li><li>Communication parameters get delivered via messages causing an actor to execute its behavior.</li></ol><h2 id="Actors-Complements-Julia"><a class="docs-heading-anchor" href="#Actors-Complements-Julia"><code>Actors</code> Complements Julia</a><a id="Actors-Complements-Julia-1"></a><a class="docs-heading-anchor-permalink" href="#Actors-Complements-Julia" title="Permalink"></a></h2><p>Actors allows Julia users to complement and enrich their programs where they find them useful. Sutter and Larus justified that as follows:</p><blockquote><p>We need higher-level language abstractions, including evolutionary extensions to current imperative languages, so that existing applications can incrementally become concurrent. The programming model must make concurrency easy to understand and reason about, not only during initial development but also during maintenance. <sup class="footnote-reference"><a id="citeref-3" href="#footnote-3">[3]</a></sup></p></blockquote><p>Actors make it easier to write clear, correct concurrent programs and offer better alternatives to sharing memory in concurrent computing:</p><ul><li>Share by communicating <sup class="footnote-reference"><a id="citeref-4" href="#footnote-4">[4]</a></sup> to functions and</li><li>use functions to localize variables and</li><li>make actors serve mutable variables without using locks.</li></ul><p>Below I will show how you can use actors in common multi-threading or distributed Julia code.</p><h2 id="Multi-threading"><a class="docs-heading-anchor" href="#Multi-threading">Multi-threading</a><a id="Multi-threading-1"></a><a class="docs-heading-anchor-permalink" href="#Multi-threading" title="Permalink"></a></h2><p>The Julia manual encourages the use of locks <sup class="footnote-reference"><a id="citeref-5" href="#footnote-5">[5]</a></sup> in order to ensure data-race freedom. But be aware that</p><blockquote><p>they are not composable. You can’t take two correct lock-based pieces of code, combine them, and know that the result is still correct. Modern software development relies on the ability to compose libraries into larger programs, and so it is a serious difficulty that we cannot build on lock-based components without examining their implementations. <sup class="footnote-reference"><a id="citeref-6" href="#footnote-6">[6]</a></sup></p></blockquote><p>An actor controlling the access to a variable or to another resource is lock-free and there are no limits to composability. Therefore if you write multi-threaded programs which should be composable or maybe used by other programs within a lock, you might consider using <code>Actors</code>.</p><h2 id="Distributed-Computing"><a class="docs-heading-anchor" href="#Distributed-Computing">Distributed Computing</a><a id="Distributed-Computing-1"></a><a class="docs-heading-anchor-permalink" href="#Distributed-Computing" title="Permalink"></a></h2><p>Actors are location transparent. You can share their links across workers to access the same actor on different workers. If local links are sent to a remote actor, they are converted to remote links.</p><h2 id="dict-server"><a class="docs-heading-anchor" href="#dict-server">A <code>Dict</code> Server</a><a id="dict-server-1"></a><a class="docs-heading-anchor-permalink" href="#dict-server" title="Permalink"></a></h2><p>This example shows how to implement a <code>Dict</code>-server actor that can be used in multi-threaded and distributed Julia code:</p><pre><code class="language-julia"># examples/mydict.jl

module MyDict
using Actors
import Actors: spawn

struct DictSrv{L}
    lk::L
end
(ds::DictSrv)() = call(ds.lk)
(ds::DictSrv)(f::Function, args...) = call(ds.lk, f, args...)
# indexing interface
Base.getindex(d::DictSrv, key) = call(d.lk, getindex, key)
Base.setindex!(d::DictSrv, value, key) = call(d.lk, setindex!, value, key)

# dict server behavior
ds(d::Dict, f::Function, args...) = f(d, args...)
ds(d::Dict) = d
# start dict server
dictsrv(d::Dict; remote=false) = DictSrv(spawn(ds, d, remote=remote))

export DictSrv, dictsrv

end</code></pre><p>This module implements a <code>DictSrv</code> type with an indexing interface. A dict server is started with <code>dictsrv</code>. Let&#39;s try it out:</p><pre><code class="language-julia">julia&gt; include(&quot;examples/mydict.jl&quot;)
Main.MyDict

julia&gt; using .MyDict, .Threads

julia&gt; d = dictsrv(Dict{Int,Int}())
DictSrv{Link{Channel{Any}}}(Link{Channel{Any}}(Channel{Any}(sz_max:32,sz_curr:0), 1, :default))

julia&gt; @threads for i in 1:1000
           d[i] = threadid()
       end

julia&gt; d()
Dict{Int64,Int64} with 1000 entries:
  306 =&gt; 3
  29  =&gt; 1
  74  =&gt; 1
  905 =&gt; 8
  176 =&gt; 2
  892 =&gt; 8
  285 =&gt; 3
  318 =&gt; 3
  873 =&gt; 7
  975 =&gt; 8
  ⋮   =&gt; ⋮

julia&gt; d[892]
8</code></pre><p>All available threads did concurrently fill our served dictionary with their thread ids. Actor access to the dictionary happens almost completely behind the scenes.</p><p>Now we try it out with distributed computing:</p><pre><code class="language-julia">julia&gt; using Distributed

julia&gt; addprocs();

julia&gt; nworkers()
17

julia&gt; @everywhere include(&quot;examples/mydict.jl&quot;)

julia&gt; @everywhere using .MyDict

julia&gt; d = dictsrv(Dict{Int,Int}(), remote=true)
DictSrv{Link{RemoteChannel{Channel{Any}}}}(Link{RemoteChannel{Channel{Any}}}(RemoteChannel{Channel{Any}}(1, 1, 278), 1, :default))

julia&gt; @spawnat :any d[myid()] = rand(Int)
Future(4, 1, 279, nothing)

julia&gt; @spawnat 17 d[myid()] = rand(Int)
Future(17, 1, 283, nothing)

julia&gt; d()
Dict{Int64,Int64} with 2 entries:
  4  =&gt; -4807958210447734689
  17 =&gt; -8998327833489977098

julia&gt; fetch(@spawnat 10 d())
Dict{Int64,Int64} with 2 entries:
  4  =&gt; -4807958210447734689
  17 =&gt; -8998327833489977098</code></pre><p>The remote <code>DictSrv</code> actor is available on all workers.</p><h2 id="Fault-Tolerance"><a class="docs-heading-anchor" href="#Fault-Tolerance">Fault Tolerance</a><a id="Fault-Tolerance-1"></a><a class="docs-heading-anchor-permalink" href="#Fault-Tolerance" title="Permalink"></a></h2><div class="admonition is-info"><header class="admonition-header">This has yet to be developed!</header><div class="admonition-body"><p>This will be implemented with the next major version.</p></div></div><h2 id="Actor-Isolation"><a class="docs-heading-anchor" href="#Actor-Isolation">Actor Isolation</a><a id="Actor-Isolation-1"></a><a class="docs-heading-anchor-permalink" href="#Actor-Isolation" title="Permalink"></a></h2><p>In order to avoid race conditions actors have to be strongly isolated from each other:</p><ol><li>they do not share state,</li><li>they must not share mutable variables.</li></ol><p>An actor stores the behavior function and arguments to it, results of computations and more. Thus it has state and this influences how it behaves.</p><p>But it does <strong>not share</strong> its state variables with its environment (only for diagnostic purposes). The <a href="../api/">API</a> functions above are a safe way to access actor state via messaging.</p><p>Mutable variables in Julia can be sent over local channels without being copied. Accessing those variables from multiple threads can cause race conditions. The programmer has to be careful to avoid those situations either by</p><ul><li>not sharing them between actors,</li><li>copying them when sending them to actors or</li><li>representing them by an actor.</li></ul><p>When sending mutable variables over remote links, they are automatically copied.</p><h2 id="Actor-Local-Dictionary"><a class="docs-heading-anchor" href="#Actor-Local-Dictionary">Actor Local Dictionary</a><a id="Actor-Local-Dictionary-1"></a><a class="docs-heading-anchor-permalink" href="#Actor-Local-Dictionary" title="Permalink"></a></h2><p>Since actors are Julia tasks, they have a local dictionary in which you can store values. You can use <a href="https://docs.julialang.org/en/v1/base/parallel/#Base.task_local_storage-Tuple{Any}"><code>task_local_storage</code></a> to access it in behavior functions. But normally argument passing should be enough to handle values in actors.</p><section class="footnotes is-size-7"><ul><li class="footnote" id="footnote-1"><a class="tag is-link" href="#citeref-1">1</a>Carl Hewitt. Actor Model of Computation: Scalable Robust Information Systems.- <a href="https://arxiv.org/abs/1008.1459">arXiv:1008.1459</a></li><li class="footnote" id="footnote-2"><a class="tag is-link" href="#citeref-2">2</a>That is to paraphrase Dale Schumacher&#39;s wonderful blog <a href="http://www.dalnefre.com/wp">Actors all the way down</a>.</li><li class="footnote" id="footnote-3"><a class="tag is-link" href="#citeref-3">3</a>H. Sutter and J. Larus. Software and the concurrency revolution. ACM Queue, 3(7), 2005.</li><li class="footnote" id="footnote-4"><a class="tag is-link" href="#citeref-4">4</a>Effective Go: <a href="https://golang.org/doc/effective_go.html#sharing">Share by Communicating</a></li><li class="footnote" id="footnote-5"><a class="tag is-link" href="#citeref-5">5</a>see <a href="https://docs.julialang.org/en/v1/manual/multi-threading/#Data-race-freedom">Data race freedom</a> in the Julia manual.</li><li class="footnote" id="footnote-6"><a class="tag is-link" href="#citeref-6">6</a>H. Sutter and J. Larus. see above</li></ul></section></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../basics/">« Actor Model</a><a class="docs-footer-nextpage" href="../behaviors/">Behaviors »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> on <span class="colophon-date" title="Monday 4 January 2021 08:55">Monday 4 January 2021</span>. Using Julia version 1.5.3.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
